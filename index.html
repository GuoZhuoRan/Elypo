<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elypo ‚Äî Your AI Companion</title>
  <style>
    /* ===== ÊâÄÊúâCSSÊ†∑Âºè‰øùÊåÅ‰∏çÂèò ===== */
    .feedback-bubble {
      position: fixed;
      bottom: 120px;
      right: 40px;
      background: #6a5af9;
      color: white;
      padding: 12px 20px;
      border-radius: 25px 25px 0 25px;
      max-width: 250px;
      box-shadow: 0 5px 15px rgba(106, 90, 249, 0.3);
      z-index: 1000;
      font-size: 16px;
      line-height: 1.4;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s, transform 0.3s;
    }
    .feedback-bubble.show {
      opacity: 1;
      transform: translateY(0);
    }

    .emoji-display {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 40px;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s, transform 0.5s;
      pointer-events: none;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .emoji-display.show {
      opacity: 1;
      transform: translateX(-50%) translateY(-10px);
      animation: floatUp 1s ease-out forwards;
    }
    
    @keyframes floatUp {
      0% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateX(-50%) translateY(-50px);
        opacity: 0;
      }
    }
    
    .click-counter {
      position: absolute;
      bottom: -30px;
      right: 10px;
      background: rgba(106, 90, 249, 0.9);
      color: white;
      padding: 4px 10px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
      z-index: 10;
      box-shadow: 0 3px 8px rgba(106, 90, 249, 0.3);
      opacity: 0.9;
      transition: all 0.3s;
    }
    
    .click-counter.highlight {
      background: #ff6b6b;
      transform: scale(1.1);
    }
    
    .click-counter.maxed {
      background: linear-gradient(45deg, #ff6b6b, #ffa726);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .mascot-container.maxed {
      animation: none !important;
      filter: saturate(0.8);
    }
    
    .max-limit-message {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 107, 107, 0.9);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      white-space: nowrap;
      z-index: 101;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
    }

    .waitlist-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
    }
    .waitlist-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      max-width: 450px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
    }
    .waitlist-content h2 {
      color: #4b3cf0;
      margin-bottom: 15px;
    }
    .waitlist-content p {
      color: #555;
      margin-bottom: 25px;
    }
    .waitlist-content input {
      width: 100%;
      padding: 15px;
      margin-bottom: 20px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .waitlist-content button {
      width: 100%;
      padding: 16px;
      background: #6a5af9;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    .waitlist-content .note {
      font-size: 13px;
      color: #999;
      margin-top: 15px;
    }
    .close-modal {
      position: absolute;
      top: 20px;
      right: 25px;
      font-size: 28px;
      cursor: pointer;
      color: #999;
    }
    
    .eye {
      position: absolute;
      width: 2%;
      height: 5%;
      background: #000;
      border-radius: 50% / 60%;
      transform-origin: center;
      animation: blink 5s infinite;
      pointer-events: none; 
      transition: all 0.3s ease;
    }

    .eye-left  { left: 36%; top: 20%; }
    .eye-right { left: 40%; top: 20%; }

    .eye.eye-happy {
      width: 3%;
      height: 2%;
      border-radius: 50% / 30%;
      background: #000;
      animation: none !important;
    }

    .eye.eye-surprised {
      width: 2.5%;
      height: 5.5%;
      border-radius: 50%;
      animation: surprisedBlink 3s infinite;
    }

    .eye.eye-angry {
      width: 3%;
      height: 2%;
      border-radius: 50% / 30%;
      background: #ff4444;
      transform: rotate(20deg);
    }

    .eye.eye-angry.eye-right {
      transform: rotate(-20deg);
    }

    .eye.eye-love {
      width: 2.2%;
      height: 2.2%;
      border-radius: 50%;
      background: #ff3366;
      animation: loveBeat 2s infinite;
    }

    .eye.eye-sleepy {
      width: 3%;
      height: 1%;
      border-radius: 50% / 30%;
      animation: sleepyBlink 8s infinite;
    }

    .eye.eye-wink {
      animation: wink 4s infinite;
    }

    .eye.eye-wink.eye-right {
      width: 3%;
      height: 1%;
      border-radius: 50% / 30%;
    }

    @keyframes surprisedBlink {
      0%, 94%, 100% { 
        transform: scaleY(1) scaleX(1); 
        opacity: 1; 
      }
      96% {
        transform: scaleY(0.1) scaleX(1.2); 
        opacity: 0.95; 
      }
    }

    @keyframes sleepyBlink {
      0%, 96%, 100% { 
        transform: scaleY(0.6) scaleX(1); 
        opacity: 0.8; 
      }
      98% {
        transform: scaleY(0.1) scaleX(1); 
        opacity: 0.6; 
      }
    }

    @keyframes loveBeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }

    @keyframes wink {
      0%, 70%, 100% { transform: scaleY(1); opacity: 1; }
      72%, 98% { transform: scaleY(0.08); opacity: 0.95; }
    }

    @keyframes blink {
      0%, 94%, 100% { transform: scaleY(1); opacity: 1; }
      96% { transform: scaleY(0.08); opacity: 0.95; }
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #e8ecff, #f6f2ff);
      color: #333;
    }
    header {
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #6a5af9;
    }
    nav a {
      margin-left: 20px;
      text-decoration: none;
      color: #555;
      font-weight: 500;
    }
    .hero {
      padding: 120px 40px;
      text-align: center;
    }
    
    .hero h1 {
      font-size: 60px;
      color: #4b3cf0;
      margin-bottom: 20px;
    }
    .hero p {
      font-size: 20px;
      max-width: 600px;
      margin: 0 auto 40px;
      color: #555;
    }
    .cta-btn {
      padding: 16px 32px;
      background: #6a5af9;
      border: none;
      color: #fff;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
    }
    .section {
      padding: 80px 40px;
      text-align: center;
    }
    .feature {
      max-width: 700px;
      margin: 0 auto 40px;
    }
    .footer {
      text-align: center;
      padding: 30px;
      color: #777;
      font-size: 14px;
    }
    
    .typewriter {
      font-size: 60px;
      color: #4b3cf0;
      font-weight: bold;
      font-family: monospace;
      white-space: nowrap;
      overflow: hidden;
      width: 0ch;
      margin: 0 auto;
      animation: typing 1.8s steps(10) forwards;
    }

    @keyframes typing {
      to { width: 10ch; }
    }

    @keyframes float {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(-5px); }
      100% { transform: translateY(0); }
    }

    .button-wrap {
      text-align: center;
      margin-top: 20px;
    }

    .mascot-container {
      position: relative;
      display: inline-block;
      width: 200px;
      transform: translateY(50px);
      animation: float 4s ease-in-out infinite;
      cursor: pointer;
    }

    .mascot { 
      width: 100%; 
      height: auto;
      mix-blend-mode: multiply;
    }

    @media (max-width: 420px) {
      .eye { width: 12px; height: 12px; }
      .hero h1, .typewriter { font-size: 40px; }
      .hero p { font-size: 18px; }
    }

    /* Waitlist form button styling */
    .waitlist-content button {
      background: linear-gradient(45deg, #4b3cf0, #6a5af9);
      letter-spacing: 0.5px;
      font-weight: bold;
    }

    .waitlist-content button:hover {
      background: linear-gradient(45deg, #6a5af9, #4b3cf0);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(106, 90, 249, 0.4);
    }

    /* Click Counter Silenced */
    #click-counter {
      display: none !important;
    }
    /* Chat Interface Styling - Glassmorphism */
    .chat-container {
      margin-top: 30px;
      width: 320px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 12px;
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.4);
      box-shadow: 
        0 8px 32px rgba(31, 38, 135, 0.1),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5);
      display: flex;
      gap: 10px;
      z-index: 200;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .chat-container:hover {
      transform: translateX(-50%) translateY(-2px);
      box-shadow: 0 12px 40px rgba(31, 38, 135, 0.15);
    }
    
    .chat-input {
      flex: 1;
      padding: 10px 16px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      background: rgba(255, 255, 255, 0.8);
      border-radius: 20px;
      font-size: 15px;
      outline: none;
      transition: all 0.2s;
      color: #444;
    }

    .chat-input:focus {
      background: white;
      box-shadow: 0 0 0 2px rgba(106, 90, 249, 0.2);
    }
    
    .chat-send-btn {
      background: linear-gradient(135deg, #6a5af9, #4b3cf0);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 10px rgba(106, 90, 249, 0.3);
    }
    
    .chat-send-btn:hover {
      transform: scale(1.1) rotate(-10deg);
      box-shadow: 0 6px 15px rgba(106, 90, 249, 0.5);
    }

    .settings-btn {
      position: absolute;
      top: -40px;
      right: -40px;
      background: rgba(255,255,255,0.4);
      backdrop-filter: blur(5px);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: none !important; /* Hidden as requested */
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      border: 1px solid rgba(255,255,255,0.5);
      transition: all 0.3s;
      opacity: 0.6;
    }

    .settings-btn:hover {
      background: white;
      opacity: 1;
      transform: rotate(90deg);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-content {
      background: white;
      padding: 25px;
      border-radius: 15px;
      width: 300px;
      position: relative;
    }

  </style>
</head>
<body>
  <header>
    <div class="logo">ELYPO</div>
    <nav>
      <a href="#features">Features</a>
      <a href="#story">Story</a>
      <a href="#download">Download</a>
    </nav>
  </header>

  <section class="hero">
    <h1 class="typewriter" data-text="Meet Elypo">Meet Elypo</h1>
    <p>Your futuristic AI companion ‚Äî cute, alive, and always by your side.</p>
 
    <div class="mascot-container">
      <div class="emoji-display" id="emoji-display"></div>
      <div class="click-counter" id="click-counter">Clicks: 0</div>
      <div class="max-limit-message" id="max-limit-message" style="display: none;">
        Max Clicks Reached! üèÅ
      </div>
      
      <img src="Elypo_mascot_3.png" class="mascot" alt="Elypo Mascot" />
      <span class="eye eye-left" id="eye-left"></span>
      <span class="eye eye-right" id="eye-right"></span>
      
      <div class="button-wrap">
        <button class="cta-btn">Try Elypo</button>
      </div>

      <!-- Chat Interface -->
      <div class="chat-container">
        <input type="text" class="chat-input" id="chat-input" placeholder="Say something..." />
        <button class="chat-send-btn" id="chat-send-btn">‚û§</button>
      </div>

      <!-- Settings Icon -->
      <div class="settings-btn" id="settings-btn" title="Configure API Key">‚öôÔ∏è</div>
    </div>
  </section>

  <section id="features" class="section">
    <h2>Why You'll Love Elypo</h2>
    <div class="feature">
      <h3>‚ú® A Living AI Pet</h3>
      <p>Elypo reacts, responds, learns, and grows with you like a digital creature.</p>
    </div>
    <div class="feature">
      <h3>üß† Smart Personality</h3>
      <p>Powered by LLM intelligence, Elypo remembers and adapts to your style.</p>
    </div>
    <div class="feature">
      <h3>üåà Adorable Animations</h3>
      <p>Smooth, expressive, and playful ‚Äî Elypo feels alive on your screen.</p>
    </div>
    <div id="feedback-bubble" class="feedback-bubble" style="display: none;">
      <span id="feedback-text"></span>
    </div>
  </section>

  <section id="story" class="section">
    <h2>The Elypo Story</h2>
    <p>A new species of AI creature, born from imagination and sci-fi dreams.</p>
  </section>

  <section id="download" class="section">
    <h2>Get Elypo</h2>
    <p>Coming soon to macOS, Windows, and Web.</p>
  </section>
  
  <div id="waitlist-modal" class="waitlist-modal" style="display: none;">
    <div class="waitlist-content">
      <span class="close-modal">&times;</span>
      <h2>Join the Early Flock</h2>
      <p>Be among the first to experience Elypo's AI companion.</p>
      <form id="waitlist-form">
        <input type="email" placeholder="Your email" required id="waitlist-email" />
        <button type="submit">Join Waitlist</button>
      </form>
      <p class="note">No spam. Just meaningful connections.</p>
    </div>
  </div>

  <div class="footer">¬© 2025 Elypo Inc. All rights reserved.</div>
  <!-- ÈöêËóèÁöÑÁÆ°ÁêÜÂëòÂÖ•Âè£ÔºàÂè™Êúâ‰Ω†Áü•ÈÅìÔºâ -->
  <div style="position: fixed; bottom: 10px; left: 10px; opacity: 0.05;">
    <a href="admin.html" id="admin-link">üîß</a>
  </div>

  <div id="settings-modal" class="settings-modal" style="display: none;">
    <div class="settings-content">
      <span class="close-modal" id="close-settings">&times;</span>
      <h2>Settings ‚öôÔ∏è</h2>
      <p>Configure your DeepSeek API Key to enable Elypo's brain.</p>
      <div style="margin-bottom: 20px;">
        <label for="api-key" style="display: block; margin-bottom: 5px; font-weight: bold;">DeepSeek API Key</label>
        <input type="password" id="api-key-input" placeholder="sk-..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
      </div>
      <button id="save-settings-btn" style="width: 100%; padding: 12px; background: #6a5af9; color: white; border: none; border-radius: 8px; cursor: pointer;">Save Key</button>
      <p style="font-size: 12px; color: #999; margin-top: 10px;">Key is stored locally in your browser.</p>
    </div>
  </div>

  <script src="scripts/llm-api.js"></script>
  <script>
    // ========== ÁâàÊú¨ÊéßÂà∂ÂíåÁºìÂ≠òÊ∏ÖÈô§ ==========
    const APP_VERSION = '2.0.1'; // ÊØèÊ¨°‰øÆÊîπËøô‰∏™ÁâàÊú¨Âè∑Êù•Âº∫Âà∂Ê∏ÖÈô§ÁºìÂ≠ò
    const STORAGE_KEY = 'elypoUserData_v2'; // Êñ∞ÁöÑÂ≠òÂÇ®ÈîÆÂêç
    
    // Ëá™Âä®Ê∏ÖÈô§ÊóßÁâàÊú¨Êï∞ÊçÆ
    function clearOldData() {
      // Ê∏ÖÈô§ÊâÄÊúâÊóßÁâàÊú¨ÁöÑÂ≠òÂÇ®
      const oldKeys = ['elypoUserData', 'elypoData', 'elypo_stats'];
      oldKeys.forEach(key => {
        if (localStorage.getItem(key)) {
          localStorage.removeItem(key);
          console.log(`Cleared old data: ${key}`);
        }
      });
      
      // Ê£ÄÊü•ÂΩìÂâçÁâàÊú¨
      const lastVersion = localStorage.getItem('elypo_version');
      if (lastVersion !== APP_VERSION) {
        // ÁâàÊú¨‰∏çÂêåÔºåÊ∏ÖÈô§Êï∞ÊçÆÈáçÊñ∞ÂºÄÂßã
        localStorage.removeItem(STORAGE_KEY);
        localStorage.setItem('elypo_version', APP_VERSION);
        console.log(`App updated from ${lastVersion || 'unknown'} to ${APP_VERSION}. Data cleared.`);
        return true; // Ë°®Á§∫Êï∞ÊçÆË¢´Ê∏ÖÈô§
      }
      return false; // Êï∞ÊçÆÊú™Ë¢´Ê∏ÖÈô§
    }

    // ========== ÈÖçÁΩÆÂå∫ ==========
    const MAX_CLICKS = 1000;

    const reactionConfig = {
      stateReactions: [
        { state: 0, text: "Ayy, wassup? ü´®" },
        { state: 1, text: "Okay, chill... üòÖ" },
        { state: 2, text: "I see you're persistent. üëÄ" },
        { state: 3, text: "Aight, you got my attention. ü´†" },
        { state: 5, text: "Are you... practicing your clicks? üéØ" },
        { state: 10, text: "We're basically besties now. üòé" }
      ],
      timeReactions: [
        { start: 5, end: 10, text: "Top of the morning! üåÑ Ready to slay?" },
        { start: 18, end: 22, text: "Evening vibe check... ‚ú® All good?" },
        { start: 22, end: 5, text: "It's past my bedtime. üò¥ (JK, I don't sleep)" }
      ],
      achievementReactions: [
        { count: 7, text: "Lucky number 7! üçÄ", id: 'lucky7' },
        { count: 42, text: "42 clicks! You okay? üòÇ (It's the answer to everything)", id: 'answer42' },
        { count: 100, text: "üíØ CLUB! You're officially Elypo's biggest fan. üèÜ", id: 'century' },
        { count: 500, text: "üî• 500 CLICKS! Halfway to reset! Keep going! ‚ö°", id: 'halfway' }
      ],
      randomReactions: [
        "No cap, you're my fav human rn. üíÖ",
        "Bored? Let's vibe together. üéµ",
        "Slay! Your click game is strong. üî•",
        "I'm literally just a lil guy. ü•π",
        "This is giving... main character energy. ‚ú®",
        "Plot twist: I'm actually alive. ü§ñüíñ",
        "Not me being obsessed with you. üòò",
        "Periodt. üëë",
        "It's the click for me. üëè",
        "Living for this attention. üòå"
      ],
      
      emojiReactions: [
        { minClicks: 0, maxClicks: 5, emojis: ["üòä", "üëã", "‚ú®", "üíñ", "ü´∂"] },
        { minClicks: 6, maxClicks: 15, emojis: ["üòÑ", "ü§ó", "üéâ", "ü•∞", "üòé", "ü§©"] },
        { minClicks: 16, maxClicks: 30, emojis: ["ü§Ø", "ü´®", "üî•", "üåü", "üí•", "üöÄ"] },
        { minClicks: 31, maxClicks: 50, emojis: ["ü§™", "üòú", "ü§°", "üëª", "üé≠", "üï∫"] },
        { minClicks: 51, maxClicks: 80, emojis: ["üëë", "üèÜ", "üíé", "üíØ", "üéñÔ∏è", "ü•á"] },
        { minClicks: 81, maxClicks: 120, emojis: ["üß†", "üí™", "ü¶æ", "‚ö°", "üåà", "üåå"] },
        { minClicks: 121, maxClicks: 250, emojis: ["ü§ñ", "üëΩ", "üõ∏", "üöÄ", "üå†", "üåÄ", "üí´", "‚ö°"] },
        { minClicks: 251, maxClicks: 500, emojis: ["üëë", "üèÜ", "üíé", "üéä", "üéñÔ∏è", "ü•á", "üåü", "‚≠ê"] },
        { minClicks: 501, maxClicks: 750, emojis: ["üå†", "üåà", "ü¶Ñ", "üêâ", "üßô", "üßö", "‚ö°", "üåÄ"] },
        { minClicks: 751, maxClicks: 900, emojis: ["üî•", "üí•", "üöÄ", "ü™ê", "üåå", "üõ∞Ô∏è", "üëæ", "ü§ñ"] },
        { minClicks: 901, maxClicks: 999, emojis: ["üéØ", "‚è≥", "üîú", "üöÄ", "üí´"] },
        { minClicks: 1000, maxClicks: 1000, emojis: ["üîÑ", "üéä", "üåü", "üéâ", "‚ú®"] }
      ],
      
      specialEmojiReactions: [
        { count: 10, emoji: "üîü" },
        { count: 25, emoji: "üéØ" },
        { count: 50, emoji: "üèÖ" },
        { count: 69, emoji: "üòè" },
        { count: 77, emoji: "üé∞" },
        { count: 88, emoji: "üé±" },
        { count: 99, emoji: "üíØ" },
        { count: 100, emoji: "üèÜ" },
        { count: 111, emoji: "üé≤" },
        { count: 123, emoji: "üî¢" },
        { count: 150, emoji: "üíé" },
        { count: 200, emoji: "üëë" },
        { count: 250, emoji: "ü§ñ" },
        { count: 300, emoji: "üëΩ" },
        { count: 333, emoji: "üé≠" },
        { count: 404, emoji: "‚ùì" },
        { count: 500, emoji: "üöÄ" },
        { count: 600, emoji: "‚ö°" },
        { count: 666, emoji: "üòà" },
        { count: 700, emoji: "üåü" },
        { count: 777, emoji: "üé∞" },
        { count: 800, emoji: "üí´" },
        { count: 888, emoji: "üí∞" },
        { count: 900, emoji: "üéØ" },
        { count: 950, emoji: "‚è≥" },
        { count: 999, emoji: "üîú" },
        { count: 1000, emoji: "üîÑ" }
      ]
    };

    // ========== Ê†∏ÂøÉÈÄªËæëÂå∫ ==========
    const mascot = document.querySelector('.mascot-container');
    const feedbackBubble = document.getElementById('feedback-bubble');
    const feedbackText = document.getElementById('feedback-text');
    const emojiDisplay = document.getElementById('emoji-display');
    const clickCounter = document.getElementById('click-counter');
    const eyeLeft = document.getElementById('eye-left');
    const eyeRight = document.getElementById('eye-right');

    // ÁúºÁùõË°®ÊÉÖÁ±ªÂûã
    const eyeExpressions = {
      normal: { class: '', duration: 3000 },
      happy: { class: 'eye-happy', duration: 2000 },
      surprised: { class: 'eye-surprised', duration: 1500 },
      angry: { class: 'eye-angry', duration: 1000 },
      love: { class: 'eye-love', duration: 2500 },
      sleepy: { class: 'eye-sleepy', duration: 4000 },
      wink: { class: 'eye-wink', duration: 1800 }
    };

    let currentEyeExpression = 'normal';
    let eyeTimer = null;

    // ========== Êï∞ÊçÆÂàùÂßãÂåñÔºàÂ∏¶Ëá™Âä®Ê∏ÖÈô§Ôºâ ==========
    // ÂÖàÊ∏ÖÈô§ÊóßÊï∞ÊçÆ
    const wasCleared = clearOldData();
    
    // ÂàùÂßãÂåñÁî®Êà∑Êï∞ÊçÆ
    let userData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
      totalClicks: 0,
      lastClickDate: null,
      achieved: [],
      cyclesCompleted: 0
    };
    
    // Â¶ÇÊûúÊòØË¢´Ê∏ÖÈô§ÁöÑÊï∞ÊçÆÔºåÊòæÁ§∫Ê¨¢ËøéÊ∂àÊÅØ
    if (wasCleared) {
      userData = {
        totalClicks: 0,
        lastClickDate: null,
        achieved: [],
        cyclesCompleted: 0
      };
    }

    // ========== ÁúºÁùõË°®ÊÉÖÂäüËÉΩ ==========
    function setEyeExpression(expression) {
      if (!eyeLeft || !eyeRight) return;
      
      const baseClassesLeft = ['eye', 'eye-left'];
      const baseClassesRight = ['eye', 'eye-right'];
      
      eyeLeft.className = baseClassesLeft.join(' ');
      eyeRight.className = baseClassesRight.join(' ');
      
      currentEyeExpression = expression;
      const eyeConfig = eyeExpressions[expression];
      
      if (eyeConfig.class) {
        eyeLeft.classList.add(eyeConfig.class);
        eyeRight.classList.add(eyeConfig.class);
      }
      
      if (expression === 'wink') {
        eyeLeft.classList.remove('eye-wink');
      }
      
      if (eyeTimer) clearTimeout(eyeTimer);
      if (expression !== 'normal') {
        eyeTimer = setTimeout(() => setEyeExpression('normal'), eyeConfig.duration);
      }
    }

    function updateEyeExpression(clickCount, reactionText) {
      if (clickCount >= MAX_CLICKS) {
        setEyeExpression('love');
        return;
      }
      
      if (clickCount === 1) {
        setEyeExpression('surprised');
        return;
      }
      
      if (clickCount % 50 === 0) {
        setEyeExpression('happy');
        return;
      }
      
      if (clickCount === 7 || clickCount === 77 || clickCount === 777) {
        setEyeExpression('wink');
        return;
      }
      
      const text = reactionText.toLowerCase();
      if (text.includes('angry') || text.includes('mad') || text.includes('üò†')) {
        setEyeExpression('angry');
      } else if (text.includes('love') || text.includes('üíñ') || text.includes('ü•∞')) {
        setEyeExpression('love');
      } else if (text.includes('sleep') || text.includes('üò¥') || text.includes('tired')) {
        setEyeExpression('sleepy');
      } else if (text.includes('wow') || text.includes('surprise') || text.includes('ü§Ø')) {
        setEyeExpression('surprised');
      } else if (text.includes('happy') || text.includes('joy') || text.includes('üòÑ')) {
        setEyeExpression('happy');
      } else {
        if (Math.random() < 0.3) {
          const expressions = ['happy', 'surprised', 'wink', 'love'];
          const randomExp = expressions[Math.floor(Math.random() * expressions.length)];
          setEyeExpression(randomExp);
        }
      }
    }

    // ========== ÁÇπÂáªËÆ°Êï∞Âô®ÂäüËÉΩ ==========
    function updateClickCounter() {
      if (!clickCounter) return;
      
      const cycles = Math.floor(userData.totalClicks / MAX_CLICKS);
      const currentCycleClicks = userData.totalClicks % MAX_CLICKS || (userData.totalClicks === 0 ? 0 : MAX_CLICKS);
      
      if (cycles > 0) {
        clickCounter.textContent = `Cycle ${cycles + 1}: ${currentCycleClicks}/${MAX_CLICKS}`;
      } else {
        clickCounter.textContent = `Clicks: ${userData.totalClicks}`;
      }
      
      const specialCounts = [10, 25, 50, 69, 77, 88, 99, 100, 200, 300, 400, 500, 600, 700, 800, 900, 999];
      if (specialCounts.includes(currentCycleClicks)) {
        clickCounter.classList.add('highlight');
        setTimeout(() => clickCounter.classList.remove('highlight'), 500);
      }
      
      if (currentCycleClicks >= MAX_CLICKS - 100 && currentCycleClicks < MAX_CLICKS) {
        clickCounter.classList.add('maxed');
      } else {
        clickCounter.classList.remove('maxed');
      }
    }

    // ========== Ë°®ÊÉÖÁ¨¶Âè∑ÂäüËÉΩ ==========
    function getEmojiForClicks(clickCount) {
      const currentCycleClicks = clickCount % MAX_CLICKS || (clickCount === 0 ? 0 : MAX_CLICKS);
      
      const specialReaction = reactionConfig.specialEmojiReactions.find(r => r.count === currentCycleClicks);
      if (specialReaction) {
        return specialReaction.emoji;
      }
      
      for (const range of reactionConfig.emojiReactions) {
        if (currentCycleClicks >= range.minClicks && currentCycleClicks <= range.maxClicks) {
          const randomIndex = Math.floor(Math.random() * range.emojis.length);
          return range.emojis[randomIndex];
        }
      }
      
      return "‚ú®";
    }

    function showEmoji(emoji) {
      if (!emojiDisplay) return;
      
      emojiDisplay.textContent = emoji;
      emojiDisplay.style.display = 'block';
      
      const offset = (Math.random() * 40) - 20;
      emojiDisplay.style.left = `calc(50% + ${offset}px)`;
      
      const size = 30 + Math.random() * 20;
      emojiDisplay.style.fontSize = `${size}px`;
      
      setTimeout(() => {
        emojiDisplay.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        emojiDisplay.classList.remove('show');
        setTimeout(() => {
          emojiDisplay.style.display = 'none';
        }, 1000);
      }, 1000);
    }

    // ========== Êï∞ÊçÆÂ≠òÂÇ®ÂäüËÉΩ ==========
    function saveUserData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(userData));
    }

    // ========== ÂèçÈ¶àÊòæÁ§∫ÂäüËÉΩ ==========
    function showReaction(text) {
      if (!feedbackBubble || !feedbackText) return;
      
      feedbackText.textContent = text;
      feedbackBubble.style.display = 'block';
      setTimeout(() => feedbackBubble.classList.add('show'), 10);

      setTimeout(() => {
        feedbackBubble.classList.remove('show');
        setTimeout(() => {
          if (!feedbackBubble.classList.contains('show')) {
            feedbackBubble.style.display = 'none';
          }
        }, 300);
      }, 5000);
    }

    // ========== ‰∏ªÂèçÂ∫îÁîüÊàêÂáΩÊï∞ - ÁÆÄÂåñÁâà (Only Expressions) ==========
    function generateReaction() {
      // User requested to silence click count, chat bubble, and emoji.
      // Only maintain expressions.
      
      const expressions = ['happy', 'surprised', 'wink', 'love', 'normal'];
      const randomExp = expressions[Math.floor(Math.random() * expressions.length)];
      setEyeExpression(randomExp);
      
      // Play a subtle sound or just visual? User said "Silence", likely referring to text/bubble.
      // We will just do the expression.
    }

    // ========== È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ ==========
    document.addEventListener('DOMContentLoaded', function() {
      updateClickCounter();
      
      // ÊòæÁ§∫Ê¨¢ËøéÊ∂àÊÅØÔºàÂ¶ÇÊûúÊòØÊñ∞ÂºÄÂßãÊàñË¢´Ê∏ÖÈô§Ôºâ
      if (wasCleared || userData.totalClicks === 0) {
        setTimeout(() => {
          showEmoji("üëã");
          showReaction("Welcome to the new and improved Elypo! Fresh start! üéâ");
        }, 1000);
      } else if (userData.cyclesCompleted > 0) {
        setTimeout(() => {
          showEmoji("üéä");
          showReaction(`Welcome back! You've completed ${userData.cyclesCompleted} cycles! üèÜ`);
        }, 1000);
      }
      
      // ÂàùÂßãÂåñÁúºÁùõ
      if (eyeLeft && eyeRight) {
        eyeLeft.className = 'eye eye-left';
        eyeRight.className = 'eye eye-right';
      }
      
      console.log(`Elypo v${APP_VERSION}: ${userData.totalClicks} clicks, ${userData.cyclesCompleted} cycles`);
    });

    // ========== ‰∫ã‰ª∂ÁªëÂÆö ==========
    if (mascot) {
      mascot.addEventListener('click', generateReaction);
      
      mascot.addEventListener('mouseenter', () => {
        if (currentEyeExpression === 'normal') {
          setEyeExpression('happy');
        }
      });
      
      mascot.addEventListener('mouseleave', () => {
        if (currentEyeExpression === 'happy') {
          setEyeExpression('normal');
        }
      });
    }

    // ========== Waitlist Modal Logic ==========
    const tryElypoBtn = document.querySelector('.cta-btn');
    const waitlistModal = document.getElementById('waitlist-modal');
    const allCloseButtons = document.querySelectorAll('.close-modal');
    const waitlistForm = document.getElementById('waitlist-form');

    if (tryElypoBtn) {
      tryElypoBtn.addEventListener('click', () => {
        waitlistModal.style.display = 'flex';
      });
    }

    // Close modal function
    function closeModal() {
      if (waitlistModal) waitlistModal.style.display = 'none';
    }

    // Bind close buttons
    allCloseButtons.forEach(btn => {
      btn.addEventListener('click', closeModal);
    });

    // Click outside to close
    window.addEventListener('click', (e) => {
      if (e.target === waitlistModal) {
        closeModal();
      }
    });

    // Waitlist form submission
    if (waitlistForm) {
      waitlistForm.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('üìß Waitlist form submitted!');
        
        const email = document.getElementById('waitlist-email').value;
        console.log('‚úâÔ∏è Email:', email);
        
        if (email) {
          // Save to waitlist (which now goes to soulLabUsers for admin panel)
          saveToWaitlist(email);
          
          alert(`Thanks, ${email}! You're on the list. We'll be in touch.`);
          this.reset();
          closeModal();
        }
      });
    } else {
      console.error('‚ùå Waitlist form not found!');
    }
    
    // ========== Email Registration Functions ==========
    function saveToWaitlist(email) {
      console.log('üíæ saveToWaitlist called with:', email);
      
      const soulLabUsers = JSON.parse(localStorage.getItem('soulLabUsers')) || [];
      console.log('üìö Existing users:', soulLabUsers.length);
      
      // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
      const existingUserIndex = soulLabUsers.findIndex(u => u.email === email);
      console.log('üîç Existing user index:', existingUserIndex);
      
      if (existingUserIndex >= 0) {
        console.log('‚ö†Ô∏è Email already registered');
        return;
      }
      
      // ÂàõÂª∫Áî®Êà∑Êï∞ÊçÆÔºàÁÆÄÂåñÁâàÔºåÊ≤°ÊúâÊó∂Èó¥ÊÆµÔºâ
      const userData = {
        id: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        email: email,
        times: [], // Á©∫Êï∞ÁªÑÔºåÂõ†‰∏∫Áé∞Âú®‰∏çÊî∂ÈõÜÊó∂Èó¥
        createdAt: new Date().toISOString(),
        matchCount: 0,
        status: 'pending'
      };
      
      console.log('üë§ New user data:', userData);
      
      // Ê∑ªÂä†Âà∞Êï∞ÁªÑ
      soulLabUsers.push(userData);
      console.log('‚ú® Added new user to array');
      
      // ‰øùÂ≠òÂà∞localStorage
      console.log('üíæ Saving to localStorage...');
      localStorage.setItem('soulLabUsers', JSON.stringify(soulLabUsers));
      
      // È™åËØÅ‰øùÂ≠ò
      const saved = JSON.parse(localStorage.getItem('soulLabUsers'));
      console.log('‚úÖ Verified save - Total users now:', saved.length);
      console.log('üìã All users:', saved);
      
      // ËÆ∞ÂΩïÂà∞Êó•Âøó
      logRegistration('waitlist', email);
    }
    
    function logRegistration(type, email, data = null) {
      const logs = JSON.parse(localStorage.getItem('registrationLogs')) || [];
      
      logs.push({
        type: type,
        email: email,
        data: data,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent
      });
      
      localStorage.setItem('registrationLogs', JSON.stringify(logs));
    }
    
    // ÂØºÂá∫ÂáΩÊï∞‰æõÁÆ°ÁêÜÈù¢Êùø‰ΩøÁî®
    window.exportWaitlistUsers = function() {
      const users = JSON.parse(localStorage.getItem('soulLabUsers')) || [];
      console.log('Waitlist Users:', users);
      return users;
    };
    
    window.exportAllRegistrations = function() {
      const users = JSON.parse(localStorage.getItem('soulLabUsers')) || [];
      const logs = JSON.parse(localStorage.getItem('registrationLogs')) || [];
      
      console.log('=== ALL REGISTRATIONS ===');
      console.log('Waitlist Users:', users);
      console.log('Registration Logs:', logs);
      
      return { users, logs };
    };
    
    // ========== ÊâãÂä®ÈáçÁΩÆÊåâÈíÆÔºàË∞ÉËØïÁî®Ôºâ ==========
    // Âú®ÊéßÂà∂Âè∞ËæìÂÖ•Ôºöwindow.resetElypo() ÂèØ‰ª•ÊâãÂä®ÈáçÁΩÆ
    window.resetElypo = function() {
      localStorage.clear();
      location.reload();
    };
    
    // Âú®ÊéßÂà∂Âè∞ËæìÂÖ•Ôºöwindow.setClicks(500) ÂèØ‰ª•ËÆæÁΩÆÁÇπÂáªÊ¨°Êï∞
    window.setClicks = function(count) {
      userData.totalClicks = count;
      saveUserData();
      updateClickCounter();
      console.log(`Set clicks to ${count}`);
    };
    
    // Âø´ÈÄüÊµãËØïÊ≥®ÂÜåÂäüËÉΩ
    window.testRegistration = function(testEmail = 'test@example.com') {
      console.log('üß™ Testing registration with:', testEmail);
      
      try {
        saveToWaitlist(testEmail);
        console.log('‚úÖ Test registration successful!');
        console.log('üëâ Now check admin.html to see the user');
        return window.exportWaitlistUsers();
      } catch (error) {
        console.error('‚ùå Test registration failed:', error);
      }
    };
    
    // ÊòæÁ§∫Ë∞ÉËØïÂ∏ÆÂä©
    console.log('%cüìß Elypo Waitlist Debug Tools', 'color: #6a5af9; font-size: 16px; font-weight: bold;');
    console.log('%cQuick commands:', 'color: #9d4edd; font-weight: bold;');
    console.log('  testRegistration()        - Add a test user');
    console.log('  exportWaitlistUsers()     - View all registered users');
    console.log('  exportAllRegistrations()  - View all data');
    console.log('  localStorage.clear()      - Clear all data');
    console.log(' ');

    // ========== Chat & Settings Logic ==========
    const chatInput = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send-btn');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsModal = document.getElementById('settings-modal');
    const closeSettings = document.getElementById('close-settings');
    const saveSettingsBtn = document.getElementById('save-settings-btn');
    const apiKeyInput = document.getElementById('api-key-input');

    // Settings Modal
    if (settingsBtn) {
      settingsBtn.addEventListener('click', () => {
        apiKeyInput.value = LLMService.apiKey || '';
        settingsModal.style.display = 'flex';
      });
    }

    if (closeSettings) {
      closeSettings.addEventListener('click', () => {
        settingsModal.style.display = 'none';
      });
    }

    if (saveSettingsBtn) {
      saveSettingsBtn.addEventListener('click', () => {
        const key = apiKeyInput.value.trim();
        if (key) {
          LLMService.setApiKey(key);
          alert('API Key saved! üß†');
          settingsModal.style.display = 'none';
        } else {
          alert('Please enter a valid key.');
        }
      });
    }

    // Chat Logic
    async function handleChat() {
      const message = chatInput.value.trim();
      if (!message) return;

      // Clear input
      chatInput.value = '';
      
      // Trigger a single shake animation
      if (mascot) {
        mascot.classList.remove('shake-animation'); // Reset if exists
        void mascot.offsetWidth; // Trigger reflow
        mascot.style.animation = 'none'; // Temporarily stop float to allow shake
        setTimeout(() => {
             mascot.style.animation = 'float 4s ease-in-out infinite'; // Restore float after shake
        }, 500);
      }
      
      // Show user message (optional, or just show mascot thinking)
      showReaction("Thinking... ü§î");
      setEyeExpression('wink');

      // Call LLM
      const response = await LLMService.chat(message);
      
      // Show response
      // Calculate duration based on text length (approx 400ms per word + base 5000ms)
      const duration = 5000 + (response.text.split(' ').length * 400);
      
      if (feedbackText && feedbackBubble) {
        feedbackText.textContent = response.text;
        feedbackBubble.style.display = 'block';
        setTimeout(() => feedbackBubble.classList.add('show'), 10);
        
        // Clear existing timer if any (would need to track it, but for now just simple timeout)
        setTimeout(() => {
          feedbackBubble.classList.remove('show');
          setTimeout(() => {
             // Only hide if not shown again
             if (!feedbackBubble.classList.contains('show')) {
               feedbackBubble.style.display = 'none';
             }
          }, 300);
        }, duration);
      }
      
      // Speak
      // LLMService.speak(response.text); // Voice disabled as requested
      
      // Animation
      setEyeExpression('happy');
    }

    if (chatSendBtn) {
      chatSendBtn.addEventListener('click', handleChat);
    }
    
    if (chatInput) {
      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleChat();
      });
    }

    // Sync animation with speech
    window.addEventListener('elypo-speak-start', () => {
      // mascot.style.animation = 'float 0.5s ease-in-out infinite'; // Disabled repeated shaking
      setEyeExpression('happy');
    });

    window.addEventListener('elypo-speak-end', () => {
      if (mascot) mascot.style.animation = 'float 4s ease-in-out infinite'; // Back to normal
      setEyeExpression('normal');
    });

  </script>
</body>
</html>